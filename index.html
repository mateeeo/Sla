<html>
  <head>
    <title>Andebol VR - GitHub Edition</title>
    <script src="https://aframe.io"></script>
    <script src="https://cdn.jsdelivr.net"></script>
  </head>
  <body>
    <a-scene physics="debug: false; gravity: -9.8" shooter>
      
      <!-- CHÃO DO CAMPO (Posicionado em 0 para não estares a flutuar) -->
      <a-plane static-body rotation="-90 0 0" width="50" height="50" color="#f58220"></a-plane>
      <a-sky color="#222"></a-sky>

      <!-- BALIZA (Posicionada a 10 metros de distância e centrada) -->
      
        <!-- Postes e Barra com Física -->
        <a-box static-body position="-1.5 1 0" width="0.1" height="2" depth="0.1" color="white"></a-box>
        <a-box static-body position="1.5 1 0" width="0.1" height="2" depth="0.1" color="white"></a-box>
        <a-box static-body position="0 2 0" width="3.1" height="0.1" depth="0.1" color="white"></a-box>
        <!-- Rede Invisível para parar a bola -->
        <a-box static-body position="0 1 0.1" width="3" height="2" depth="0.05" visible="false"></a-box>
      

      <!-- GUARDA-REDES (Bloco Vermelho que defende sozinho) -->
      <a-box id="keeper"
             static-body
             position="0 1 -9.8" 
             width="0.8" height="1.8" depth="0.3" 
             color="#FF0000"
             animation="property: position; to: 1.2 1 -9.8; from: -1.2 1 -9.8; dur: 1500; dir: alternate; loop: true; easing: linear">
      </a-box>

      <!-- CÂMARA (ALTURA HUMANA: 1.6m) -->
      
        
        
      

      <a-text value="USA O TEU STICK PARA MARCAR GOLO!" position="0 3.5 -5" align="center" color="white" width="4"></a-text>
    </a-scene>

    <script>
      AFRAME.registerComponent('shooter', {
        init: function () {
          const disparar = () => {
            const scene = document.querySelector('a-scene');
            const cam = document.querySelector('[camera]');
            const bola = document.createElement('a-sphere');
            
            bola.setAttribute('radius', '0.15');
            bola.setAttribute('color', '#4CC3D9');
            bola.setAttribute('dynamic-body', 'mass: 1; restitution: 0.5');
            
            // A bola sai da tua posição atual
            const pos = cam.getAttribute('position');
            bola.setAttribute('position', `${pos.x} ${pos.y} ${pos.z - 0.5}`);

            // Direção do remate baseada no Giroscópio
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(cam.object3D.quaternion);
            direction.multiplyScalar(22); // Força do remate

            scene.appendChild(bola);

            bola.addEventListener('body-loaded', () => {
              const p = bola.body.position;
              // Aplicamos um pouco de "arco" para cima no remate
              bola.body.applyImpulse(new CANNON.Vec3(direction.x, direction.y + 3, direction.z), new CANNON.Vec3(p.x, p.y, p.z));
            });

            // Limpa as bolas velhas para não pesar no GitHub/Telemóvel
            setTimeout(() => { if(bola.parentNode) bola.parentNode.removeChild(bola); }, 4000);
          };

          // Suporte para Stick Bluetooth (Qualquer tecla) e Toque no Ecrã
          window.addEventListener('keydown', disparar);
          window.addEventListener('click', disparar);
        }
      });
    </script>
  </body>
</html>
