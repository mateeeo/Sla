<!DOCTYPE html>
<html>
  <head>
    <title>Andebol VR - Final Fix</title>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net"></script>
  </head>
  <body>
    <!-- vr-mode-ui garante que o botão dos óculos aparece no telemóvel -->
    <a-scene physics="debug: false; gravity: -9.8" shooter vr-mode-ui="enabled: true">
      
      <!-- Chão -->
      <a-plane static-body rotation="-90 0 0" width="50" height="50" color="#f58220"></a-plane>
      <a-sky color="#222"></a-sky>

      <!-- BALIZA (Posicionada em -10) -->
      
        <a-box static-body position="-1.5 1 0" width="0.1" height="2" depth="0.1" color="white"></a-box>
        <a-box static-body position="1.5 1 0" width="0.1" height="2" depth="0.1" color="white"></a-box>
        <a-box static-body position="0 2 0" width="3.1" height="0.1" depth="0.1" color="white"></a-box>
      

      <!-- GUARDA-REDES (À frente da baliza em -9.5) -->
      <a-box id="keeper"
             static-body
             position="0 1 -9.5" 
             width="0.8" height="1.6" depth="0.3" 
             color="red"
             animation="property: position; to: 1.2 1 -9.5; from: -1.2 1 -9.5; dur: 1500; dir: alternate; loop: true; easing: linear">
      </a-box>

      <!-- Câmara e Mira -->
      
        
          
          
        
      

    </a-scene>

    <script>
      AFRAME.registerComponent('shooter', {
        init: function () {
          const cena = this.el;
          
          const disparar = () => {
            const cam = document.querySelector('[camera]');
            const bola = document.createElement('a-sphere');
            
            bola.setAttribute('radius', '0.15');
            bola.setAttribute('color', '#4CC3D9');
            // 'dynamic-body' faz a bola mover-se com física
            bola.setAttribute('dynamic-body', 'mass: 1; restitution: 0.5');
            
            const pos = cam.object3D.getWorldPosition(new THREE.Vector3());
            bola.setAttribute('position', `${pos.x} ${pos.y} ${pos.z - 0.5}`);

            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(cam.object3D.quaternion);
            direction.multiplyScalar(25); // Força aumentada

            cena.appendChild(bola);

            // Se a bola ficar parada, este timer força o movimento
            bola.addEventListener('body-loaded', () => {
              const força = new CANNON.Vec3(direction.x, direction.y + 4, direction.z);
              bola.body.velocity.set(força.x, força.y, força.z);
            });

            setTimeout(() => { if(bola.parentNode) bola.parentNode.removeChild(bola); }, 4000);
          };

          window.addEventListener('keydown', disparar);
          window.addEventListener('click', disparar);
        }
      });
    </script>
  </body>
</html>
